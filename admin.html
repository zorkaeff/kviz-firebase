<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<title>Kviz – Admin</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { font-family: Arial; background:#111; color:white; padding:20px; }
button { padding:10px 18px; margin:6px; font-size:16px; cursor:pointer; }
input { padding:8px; font-size:16px; }
.table { margin-top:20px; border-collapse: collapse; width:100%; }
.table th, .table td { border:1px solid #444; padding:6px; text-align:center; }
.timer { font-size:32px; color:yellow; }
</style>
</head>
<body>

<h1>ADMIN – KONTROLA KVIZA</h1>

<div>
  <label>Admin ključ:</label>
  <input type="password" id="key" />
  <button onclick="login()">Login</button>
</div>

<hr>

<div id="panel" style="display:none">

<h2>Status igre</h2>
<div id="status">Nema igre</div>
<div class="timer" id="timer">--</div>

<h2>Kontrole</h2>
<button onclick="startGame()">START KVIZA</button>
<button onclick="pauseGame()">PAUZA</button>
<button onclick="nextPhase()">SLJEDEĆA FAZA</button>

<h2>Pitanje</h2>
<input id="questionText" placeholder="Tekst pitanja" style="width:80%" />
<br><br>
<label>Točan odgovor:</label>
<select id="correct">
  <option>A</option>
  <option>B</option>
  <option>C</option>
  <option>D</option>
</select>

<button onclick="sendQuestion()">POSTAVI PITANJE</button>

<h2>Igrači</h2>
<table class="table" id="players">
<thead>
<tr><th>Igrač</th><th>Bodovi</th><th>Eliminacija</th></tr>
</thead>
<tbody></tbody>
</table>

</div>

<script>
const ADMIN_KEY = "ADMIN123"; // PROMIJENI

const firebaseConfig = {
  apiKey: "AIzaSyB5jeu860fNmmysc51wcb5fej7Bz_6gW-Q",
  authDomain: "hpddd-b9bef.firebaseapp.com",
  databaseURL: "https://hpddd-b9bef-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hpddd-b9bef",
  storageBucket: "hpddd-b9bef.appspot.com",
  messagingSenderId: "520105963434",
  appId: "1:520105963434:web:5b25d1f9f28512ae1145d3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function login(){
  if(document.getElementById('key').value === ADMIN_KEY){
    document.getElementById('panel').style.display='block';
  } else alert('Pogrešan ključ');
}

function startGame(){
  db.ref('game').set({
    phase:'main',
    round:1,
    question:1,
    phaseEndsAt: Date.now()+20000
  });
}

function pauseGame(){
  db.ref('game/phase').set('paused');
}

function nextPhase(){
  db.ref('game').once('value',s=>{
    const g=s.val();
    const order=['main','questionMark','reveal'];
    const i=order.indexOf(g.phase);
    if(i>=0 && i<order.length-1){
      db.ref('game').update({
        phase:order[i+1],
        phaseEndsAt: Date.now()+20000
      });
    }
  });
}

function sendQuestion(){
  db.ref('game').update({
    questionText: document.getElementById('questionText').value,
    correct: document.getElementById('correct').value,
    phase:'main',
    phaseEndsAt: Date.now()+20000
  });
}

// live status

db.ref('game').on('value',s=>{
  const g=s.val();
  if(!g) return;
  document.getElementById('status').innerText = `Faza: ${g.phase}`;
  if(g.phaseEndsAt){
    document.getElementById('timer').innerText = Math.max(0,Math.ceil((g.phaseEndsAt-Date.now())/1000))+'s';
  }
});

// lista igrača

db.ref('results').on('value',snap=>{
  const tb=document.querySelector('#players tbody');
  tb.innerHTML='';
  snap.forEach(p=>{
    const r=p.val();
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${p.key}</td><td>${r.points||0}</td><td><button onclick=\"eliminate('${p.key}')\">X</button></td>`;
    tb.appendChild(tr);
  });
});

function eliminate(p){
  db.ref(`players/${p}`).remove();
}
</script>
</body>
</html>
