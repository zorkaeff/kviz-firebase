<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<title>Kviz ‚Äì Admin</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { font-family: Arial; background:#111; color:white; text-align:center; }
button { margin:8px; padding:14px 22px; font-size:22px; cursor:pointer; }
#players { margin:20px auto; width:60%; border-collapse:collapse; }
#players th, #players td { border:1px solid white; padding:6px; text-align:center; }
th { background:#222; }
#controls { display:none; margin-top:20px; }
</style>
</head>
<body>

<h2>Admin ‚Äì Kviz</h2>

<div id="loginDiv">
  <input type="password" id="adminkey" placeholder="Admin kljuƒç" />
  <button onclick="login()">Login</button>
</div>

<div id="controls">
  <button onclick="startGame()">‚ñ∂ Start kruga</button>
  <button onclick="pauseGame()">‚è∏ Pauza</button>
  <button onclick="nextQuestion()">‚û° Sljedeƒáe pitanje</button>
  <button onclick="eliminate()">‚ùå Eliminiraj zadnjeg</button>
</div>

<h3>Prijavljeni igraƒçi</h3>
<table id="players">
  <thead>
    <tr><th>Igraƒç</th><th>Bodovi</th><th>!</th><th>?</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// Admin kljuƒç (promijeni po ≈æelji)
const ADMIN_KEY = "tajni123";

const firebaseConfig = {
  apiKey: "AIzaSyB5jeu860fNmmysc51wcb5fej7Bz_6gW-Q",
  authDomain: "hpddd-b9bef.firebaseapp.com",
  databaseURL: "https://hpddd-b9bef-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hpddd-b9bef",
  storageBucket: "hpddd-b9bef.appspot.com",
  messagingSenderId: "520105963434",
  appId: "1:520105963434:web:5b25d1f9f28512ae1145d3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// üîê Login funkcija
function login(){
  const key = document.getElementById("adminkey").value;
  if(key===ADMIN_KEY){
    document.getElementById("controls").style.display="block";
    document.getElementById("loginDiv").style.display="none";
    updatePlayers();
  } else {
    alert("Krivi kljuƒç");
  }
}

// Start kruga
function startGame(){
  const now = Date.now();
  db.ref('game').update({phase:'main', phaseEndsAt: now + 20000}); // 20s main
  alert("Krug startan!");
}

// Pauza
function pauseGame(){
  db.ref('game').update({phase:'paused'});
}

// Sljedeƒáe pitanje
function nextQuestion(){
  db.ref('game').once('value',snap=>{
    const g = snap.val() || {round:0,question:0};
    const next = {
      round: g.round || 1,
      question: (g.question||0)+1,
      phase: 'main',
      phaseEndsAt: Date.now() + 20000,
      questionText: `Pitanje ${g.question+1 || 1}`,
      correct: 'A'
    };
    db.ref('game').set(next);
  });
}

// Ruƒçna eliminacija
function eliminate(){
  db.ref('results').once('value', snap => {
    const players = [];
    snap.forEach(ch => {
      const r = ch.val();
      players.push({
        name: ch.key,
        points: r.points || 0,
        question: r.question || 0,
        exclam: r.exclam || 0,
        time: r.time || 0
      });
    });
    if(players.length<=1){ alert("Ne mo≈æe eliminirati ‚Äì ostao je jedan igraƒç"); return; }

    players.sort((a,b)=>{
      if(a.points!==b.points) return a.points-b.points;
      if(a.question!==b.question) return a.question-b.question;
      if(a.exclam!==b.exclam) return a.exclam-b.exclam;
      return b.time-a.time;
    });

    const eliminated = players[0];
    if(confirm(`Eliminirati ${eliminated.name}?`)){
      db.ref(`players/${eliminated.name}`).remove();
      db.ref(`eliminated/${eliminated.name}`).set({ at: Date.now() });
      alert(`${eliminated.name} je eliminiran`);
    }
  });
}

// Prikaz igraƒça i bodova
function updatePlayers(){
  db.ref('results').on('value',snap=>{
    const tbody = document.querySelector('#players tbody');
    tbody.innerHTML="";
    snap.forEach(ch=>{
      const r = ch.val();
      const tr = document.createElement('tr');
      tr.innerHTML=`<td>${ch.key}</td><td>${r.points||0}</td><td>${r.exclam||0}</td><td>${r.question||0}</td>`;
      tbody.appendChild(tr);
    });
  });
}
</script>
</body>
</html>
