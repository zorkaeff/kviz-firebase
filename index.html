<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<title>Kviz – Pitanje 1</title>
<link rel="icon" href="data:," />

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family: Arial; background:#111; color:white; text-align:center; }
button { margin:6px; padding:12px 18px; font-size:18px; cursor:pointer; }
.hidden { display:none; }
.timer { font-size:32px; margin:10px; }
#allResults { margin-top:20px; text-align:left; display:inline-block; }
.correct { color: #0f0; }
.wrong { color: #f33; }
</style>
</head>
<body>

<h2>Pitanje 1: Koji je točan odgovor?</h2>
<div class="timer" id="timer">20</div>

<!-- FAZA 1 -->
<div id="mainPhase">
  <button onclick="answerMain('A!')">A!</button>
  <button onclick="answerMain('A.')">A.</button>
  <button onclick="answerMain('B!')">B!</button>
  <button onclick="answerMain('B.')">B.</button>
  <button onclick="answerMain('C!')">C!</button>
  <button onclick="answerMain('C.')">C.</button>
  <button onclick="answerMain('D!')">D!</button>
  <button onclick="answerMain('D.')">D.</button>
  <button onclick="answerMain('?')">?</button>
</div>

<!-- FAZA 2 -->
<div id="lukavacPhase" class="hidden">
  <h3>Lukavac – 10 sekundi</h3>
  <button onclick="answerLukavac('A')">A?</button>
  <button onclick="answerLukavac('B')">B?</button>
  <button onclick="answerLukavac('C')">C?</button>
  <button onclick="answerLukavac('D')">D?</button>
</div>

<!-- Rezultati -->
<div id="allResults"></div>

<script>
/* KONFIGURACIJA */
const correctAnswer = "C";

/* IME IGRAČA */
let player = localStorage.getItem("player");
if (!player) {
  do {
    player = prompt("Unesi ime igrača:")?.trim();
  } while (!player);
  localStorage.setItem("player", player);
}

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyB5jeu860fNmmysc51wcb5fej7Bz_6gW-Q",
  authDomain: "hpddd-b9bef.firebaseapp.com",
  databaseURL: "https://hpddd-b9bef-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hpddd-b9bef",
  storageBucket: "hpddd-b9bef.appspot.com",
  messagingSenderId: "520105963434",
  appId: "1:520105963434:web:5b25d1f9f28512ae1145d3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* TIMER & LOGIKA */
let mainTime = 20;
let lukTime = 10;
let mainAnswered = false;
let usedLukavac = false;

const timerEl = document.getElementById("timer");

/* TIMER FAZA 1 */
const interval = setInterval(() => {
  timerEl.innerText = mainTime;
  mainTime--;
  if (mainTime < 0) {
    clearInterval(interval);
    endMainPhase();
  }
}, 1000);

/* FAZA 1 – ODABIR */
function answerMain(choice) {
  if (mainAnswered) return;
  mainAnswered = true;

  if (choice === "?") usedLukavac = true;

  db.ref("results/" + player).set({
    main: choice,
    usedLukavac
  });

  document.getElementById("mainPhase").classList.add("hidden");
}

/* KRAJ FAZE 1 */
function endMainPhase() {
  if (!mainAnswered) {
    usedLukavac = true;
    db.ref("results/" + player).set({
      main: "?",
      usedLukavac
    });
  }
  if (usedLukavac) startLukavac();
  else showResults();
}

/* FAZA 2 – LUKAVAC */
function startLukavac() {
  document.getElementById("lukavacPhase").classList.remove("hidden");
  const lukInterval = setInterval(() => {
    timerEl.innerText = lukTime;
    lukTime--;
    if (lukTime < 0) {
      clearInterval(lukInterval);
      autoFailLukavac();
      showResults();
    }
  }, 1000);
}

/* LUKAVAC ODABIR */
function answerLukavac(choice) {
  db.ref("results/" + player).update({ lukavac: choice });
  document.getElementById("lukavacPhase").innerHTML = "Odgovor spremljen";
}

/* AUTO FAIL */
function autoFailLukavac() {
  db.ref("results/" + player).update({ lukavac: "AUTO" });
  document.getElementById("lukavacPhase").innerHTML = "Odgovor automatski neodabran";
}

/* BODOVI */
function calculatePoints(data) {
  let pts = 0;
  // FAZA 1
  if (data.main) {
    if (data.main === correctAnswer + "!") pts += 100;
    else if (data.main[0] === correctAnswer && data.main[1] === ".") pts += 50;
    else if (data.main[1] === "!") pts -= 100; // netočno A!, B! itd.
    else pts += 0; // A., B., D. netočno
  }
  // FAZA 2 – Lukavac
  if (data.lukavac && data.lukavac !== "AUTO") {
    if (data.lukavac === correctAnswer) pts += 50;
    else pts -= 50;
  }
  return pts;
}

/* PRIKAZ REZULTATA NAKON 30 SEKUNDI */
function showResults() {
  db.ref("results/").once("value").then(snapshot => {
    const results = snapshot.val() || {};
    const container = document.getElementById("allResults");
    container.innerHTML = "<h3>Rezultati:</h3>";
    for (const [name, data] of Object.entries(results)) {
      const pts = calculatePoints(data);
      container.innerHTML += `<p>${name}: Main = ${data.main || "-"}, Lukavac = ${data.lukavac || "-"}, Points = ${pts}</p>`;
    }
  });
}

/* REAL-TIME PRIKAZ TRENUCIH ODGOVORA */
db.ref("results/").on("value", snapshot => {
  const results = snapshot.val() || {};
  const container = document.getElementById("allResults");
  let html = "<h3>Trenutni odgovori:</h3>";
  for (const [name, data] of Object.entries(results)) {
    html += `<p>${name}: Main=${data.main || "-"}, Lukavac=${data.lukavac || "-"}</p>`;
  }
  container.innerHTML = html;
});
</script>
</body>
</html>
