<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<title>Kviz</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body { font-family: Arial; background:#111; color:white; text-align:center; }
button { margin:6px; padding:12px 18px; font-size:18px; cursor:pointer; }
.hidden { display:none; }
.timer { font-size:32px; margin:10px; }
table { margin:auto; border-collapse: collapse; width: 80%; }
th, td { border: 1px solid white; padding: 6px; }
</style>
</head>
<body>

<h2>Kviz Pitanja</h2>
<div class="timer" id="timer">ƒåekanje starta kviza...</div>
<div id="questionPhase" class="hidden">
  <h3 id="questionText"></h3>
  <div id="answerButtons"></div>
  <div id="roundInfo"></div>
</div>
<h3>Leaderboard</h3>
<table id="leaderboard">
  <thead>
    <tr><th>Igraƒç</th><th>Bodovi</th><th>!</th><th>?</th><th>Vrijeme (s)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const player = localStorage.getItem("player") || prompt("Ime igraƒça:");
localStorage.setItem("player", player);

const firebaseConfig = {
  apiKey: "AIzaSyB5jeu860fNmmysc51wcb5fej7Bz_6gW-Q",
  authDomain: "hpddd-b9bef.firebaseapp.com",
  databaseURL: "https://hpddd-b9bef-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "hpddd-b9bef",
  storageBucket: "hpddd-b9bef.appspot.com",
  messagingSenderId: "520105963434",
  appId: "1:520105963434:web:5b25d1f9f28512ae1145d3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const quizStartTime = Date.now() + 5000;
const rounds = 6;
const questionsPerRound = 10;
let currentRound = 0;
let currentQuestionIndex = 0;
let timerInterval;

// üî• 6 KRUGOVA √ó 10 PITANJA
const allQuestions = [
  [
    { text:"Koliko je 2 + 2?", correct:"C", options:["1","2","4","3"] },
    { text:"Koja boja je nebo?", correct:"A", options:["Plava","Zelena","Crvena","≈Ωuta"] },
    { text:"Koji planet je najbli≈æi Suncu?", correct:"B", options:["Venera","Merkur","Mars","Jupiter"] },
    { text:"Koji dan dolazi nakon ponedjeljka?", correct:"D", options:["Petak","Nedjelja","Srijeda","Utorak"] },
    { text:"Koja ≈æivotinja mjauƒçe?", correct:"C", options:["Pas","Krava","Maƒçka","Ovca"] },
    { text:"Koja je suprotnost rijeƒçi 'vruƒáe'?", correct:"A", options:["Hladno","Toplo","Vla≈æno","Suho"] },
    { text:"Koliko sati ima jedan dan?", correct:"B", options:["12","24","36","48"] },
    { text:"Koja boja nastaje mije≈°anjem plave i ≈æute?", correct:"D", options:["Crvena","Zelena","Ljubiƒçasta","Zelena"] },
    { text:"Koji broj dolazi nakon 9?", correct:"C", options:["7","8","10","11"] },
    { text:"Koja ≈æivotinja ima dugi vrat?", correct:"B", options:["Slon","≈Ωirafa","Konj","Lav"] }
  ],
  [
    { text:"Koja je najveƒáa ≈æivotinja na svijetu?", correct:"A", options:["Plavi kit","Slon","Medvjed","Lav"] },
    { text:"Koja je boja banane?", correct:"B", options:["Plava","≈Ωuta","Crvena","Zelena"] },
    { text:"Koji mjesec dolazi nakon lipnja?", correct:"C", options:["Svibanj","Srpanj","Srpanj","Kolovoz"] },
    { text:"Koliko je 5 x 5?", correct:"D", options:["20","15","25","25"] },
    { text:"Koja ptica ne mo≈æe letjeti?", correct:"A", options:["Pingvin","Golub","Lastavica","Orao"] },
    { text:"Koja dr≈æava je poznata po piramidama?", correct:"B", options:["Italija","Egipat","Grƒçka","Meksiko"] },
    { text:"Koji je oblik nogometne lopte?", correct:"C", options:["Kvadrat","Trokut","Kugla","Pravougaonik"] },
    { text:"Koja planeta je poznata kao crvena planeta?", correct:"D", options:["Jupiter","Venera","Saturn","Mars"] },
    { text:"Koja ≈æivotinja daje mlijeko?", correct:"A", options:["Krava","Ovca","Pas","Maƒçka"] },
    { text:"Koji je glavni grad Hrvatske?", correct:"B", options:["Split","Zagreb","Rijeka","Osijek"] }
  ],
  [
    { text:"Koji kontinent je najveƒái?", correct:"C", options:["Afrika","Europa","Azija","Antarktika"] },
    { text:"Koja je boja naranƒçe?", correct:"D", options:["Plava","Zelena","Crvena","Naranƒçasta"] },
    { text:"Koja ≈æivotinja je kralj d≈æungle?", correct:"A", options:["Lav","Tigar","Slon","Leopard"] },
    { text:"Koliko dana ima veljaƒça (ne prestupna godina)?", correct:"B", options:["30","28","29","31"] },
    { text:"Koja riba ima ≈°krge?", correct:"C", options:["Kit","Ajkula","Riba","Delfin"] },
    { text:"Koja dr≈æava je poznata po sushi-ju?", correct:"D", options:["Kina","Tajland","Vijetnam","Japan"] },
    { text:"Koji instrument ima tipke i svira se rukama?", correct:"A", options:["Piano","Gitara","Bubanj","Violina"] },
    { text:"Koji sport ukljuƒçuje reket i lopticu?", correct:"B", options:["Nogomet","Tenis","Ko≈°arka","Odbojka"] },
    { text:"Koliko kontinenata postoji?", correct:"C", options:["5","6","7","8"] },
    { text:"Koji je najbr≈æi kopneni sisavac?", correct:"D", options:["Slon","Konj","Tigar","Gepard"] }
  ],
  [/* Krug 4 */],
  [/* Krug 5 */],
  [/* Krug 6 */]
];

function calcPoints(choice, correct) {
  if(choice.endsWith('!')) return choice[0]===correct ? 100 : -100;
  if(choice.endsWith('.')) return choice[0]===correct ? 50 : 0;
  if(choice.endsWith('?')) return choice[0]===correct ? 50 : -50;
  return 0;
}

setTimeout(()=>{
  document.getElementById("timer").innerText = "Kviz poƒçinje!";
  document.getElementById("questionPhase").classList.remove("hidden");
  startQuestion(currentRound,currentQuestionIndex);
}, quizStartTime - Date.now());

function startQuestion(round,index){
  if(round>=rounds) return;
  const question = allQuestions[round][index];
  document.getElementById("questionText").innerText = question.text;
  document.getElementById("roundInfo").innerText = `Krug ${round+1}, Pitanje ${index+1}`;
  const buttonsDiv = document.getElementById("answerButtons");
  buttonsDiv.innerHTML='';
  ['A','B','C','D'].forEach(opt=>{
    ['.','!','?'].forEach(suffix=>{
      const btn=document.createElement('button');
      btn.innerText = opt+suffix;
      btn.onclick=()=>submitAnswer(opt+suffix,question.correct);
      buttonsDiv.appendChild(btn);
    });
  });
  startTimer(round,index);
}

function startTimer(round,index){
  let time=20;
  timerInterval=setInterval(()=>{
    document.getElementById("timer").innerText=`Vrijeme: ${time}s`;
    time--;
    if(time<0){
      clearInterval(timerInterval);
      autoFail(round,index);
    }
  },1000);
}

function submitAnswer(choice,correct){
  clearInterval(timerInterval);
  const points=calcPoints(choice,correct);
  const elapsed=20-(parseInt(document.getElementById("timer").innerText.match(/\d+/))||0);
  db.ref(`results/${player}`).once('value',snap=>{
    let data=snap.val()||{points:0,exclam:0,questionMarks:0,timeUsed:0};
    if(choice.endsWith('!')) data.exclam++;
    if(choice.endsWith('?')) data.questionMarks++;
    data.points+=points;
    data.timeUsed+=elapsed;
    db.ref(`results/${player}`).set(data);
    showNext(currentRound,currentQuestionIndex+1);
  });
}

function autoFail(round,index){
  submitAnswer('?','');
}

function showNext(round,nextIndex){
  if(nextIndex>=questionsPerRound){
    currentRound++; currentQuestionIndex=0;
    setTimeout(()=>{ if(currentRound<rounds) startQuestion(currentRound,0); },40000);
  }else{
    currentQuestionIndex=nextIndex;
    startQuestion(round,nextIndex);
  }
  updateLeaderboard();
}

function updateLeaderboard(){
  db.ref('results').once('value',snap=>{
    const tbody=document.querySelector('#leaderboard tbody');
    tbody.innerHTML='';
    const players=[];
    snap.forEach(ch=>players.push({name:ch.key,...ch.val()}));
    players.sort((a,b)=>{
      if(b.points!==a.points) return b.points-a.points;
      if(a.exclam!==b.exclam) return a.exclam-b.exclam;
      return a.timeUsed-b.timeUsed;
    });
    players.forEach(p=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${p.name}</td><td>${p.points}</td><td>${p.exclam}</td><td>${p.questionMarks}</td><td>${p.timeUsed}</td>`;
      tbody.appendChild(tr);
    });
  });
}
</script>
</body>
</html>
