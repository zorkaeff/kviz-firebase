<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8" />
<title>Kviz</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: Arial; background:#111; color:white; text-align:center; }
button { margin:6px; padding:12px 18px; font-size:18px; cursor:pointer; }
.hidden { display:none; }
.timer { font-size:32px; margin:10px; }
</style>
</head>

<body>

<h2>Kviz pitanje</h2>
<div class="timer" id="timer">20</div>

<!-- FAZA 1 -->
<div id="mainPhase">
  <button onclick="answerMain('A!')">A!</button>
  <button onclick="answerMain('A.')">A.</button>
  <button onclick="answerMain('B!')">B!</button>
  <button onclick="answerMain('B.')">B.</button>
  <button onclick="answerMain('C!')">C!</button>
  <button onclick="answerMain('C.')">C.</button>
  <button onclick="answerMain('D!')">D!</button>
  <button onclick="answerMain('D.')">D.</button>
  <button onclick="answerMain('?')">?</button>
</div>

<!-- FAZA 2 -->
<div id="lukavacPhase" class="hidden">
  <h3>Lukavac â€“ 10 sekundi</h3>
  <button onclick="answerLukavac('A')">A?</button>
  <button onclick="answerLukavac('B')">B?</button>
  <button onclick="answerLukavac('C')">C?</button>
  <button onclick="answerLukavac('D')">D?</button>
</div>

<canvas id="chart" class="hidden"></canvas>

<script>
/* ðŸ”¥ KONFIGURACIJA */
const correctAnswer = "C"; // TOÄŒAN ODGOVOR
const player = localStorage.getItem("player") || prompt("Ime igraÄa:");
localStorage.setItem("player", player);

/* ðŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey: "API_KEY",
  databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "PROJECT_ID"
});
const db = firebase.database();

/* ðŸ”¢ BODOVI */
function calcMain(choice) {
  if (choice === "?") return null;
  const a = choice[0], t = choice[1];
  if (a !== correctAnswer) return t === "!" ? -100 : 0;
  return t === "!" ? 100 : 50;
}
function calcLukavac(choice) {
  return choice === correctAnswer ? 50 : -50;
}

/* â± FAZA 1 */
let time = 20;
let mainAnswered = false;
let usedLukavac = false;

const interval = setInterval(() => {
  document.getElementById("timer").innerText = time;
  time--;
  if (time < 0) endMainPhase();
}, 1000);

function answerMain(choice) {
  if (mainAnswered) return;
  mainAnswered = true;

  if (choice === "?") usedLukavac = true;

  db.ref("results/" + player).set({
    main: choice,
    usedLukavac
  });
}

function endMainPhase() {
  clearInterval(interval);
  if (!mainAnswered) {
    usedLukavac = true;
    db.ref("results/" + player).set({ main:"?", usedLukavac });
  }
  if (usedLukavac) startLukavac();
}

/* â± FAZA 2 */
function startLukavac() {
  document.getElementById("mainPhase").classList.add("hidden");
  document.getElementById("lukavacPhase").classList.remove("hidden");

  let t = 10;
  const luk = setInterval(() => {
    document.getElementById("timer").innerText = t;
    t--;
    if (t < 0) {
      clearInterval(luk);
      autoFailLukavac();
    }
  }, 1000);
}

function answerLukavac(choice) {
  const pts = calcLukavac(choice);
  db.ref("results/" + player).update({ lukavac: choice, points: pts });
  document.getElementById("lukavacPhase").innerHTML = "Odgovor spremljen";
}

function autoFailLukavac() {
  db.ref("results/" + player).update({ lukavac:"AUTO", points:-50 });
}
</script>

</body>
</html>
